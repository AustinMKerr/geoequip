<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Thanks for Scanning</title>
    <script>
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            let paramStr = "";
            for (let param of params) {
                paramStr += `&${param[0]}=${param[1]}`;
            }
            return paramStr;
        }

        function promptForName() {
            let name = localStorage.getItem('userName');
            if (!name) {
                name = prompt("Please enter your full name:");
                if (name) {
                    localStorage.setItem('userName', name);
                }
            }
            return name;
        }

        function getCurrentDateTime() {
            var now = new Date();
            return now.toISOString();
        }

        function sendLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;
                    var name = promptForName();
                    var dateTime = getCurrentDateTime();

                    var geocodeUrl = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${latitude},${longitude}&key=YOUR_API_KEY`;

                    fetch(geocodeUrl)
                        .then(response => response.json())
                        .then(data => {
                            var address = data.results && data.results[0] ? data.results[0].formatted_address : `${latitude},${longitude}`;
                            var params = `latitude=${latitude}&longitude=${longitude}&address=${encodeURIComponent(address)}&name=${encodeURIComponent(name)}&datetime=${dateTime}`;
                            params += getQueryParams();

                            var xhr1 = new XMLHttpRequest();
                            var url1 = "https://hooks.zapier.com/hooks/catch/11099321/29v5fca/";
                            xhr1.open("POST", url1, true);
                            xhr1.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                            xhr1.send(params);

                            var xhr2 = new XMLHttpRequest();
                            var url2 = "https://hooks.airtable.com/workflows/v1/genericWebhook/app3ZqqfJhNrwUEsQ/wfl6BVE6OPscEuI8l/wtrwqzGV9H0MVoVtv";
                            xhr2.open("POST", url2, true);
                            xhr2.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                            xhr2.send(params);
                        })
                        .catch(error => console.error('Error:', error));
                }, function(error) {
                    console.error("Error Code = " + error.code + " - " + error.message);
                    alert("Geolocation access is denied. Please enable location services in your browser settings.");
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }
    </script>
</head>
<body onload="sendLocation()">
    <h1>Thanks for Scanning</h1>
</body>
</html>
